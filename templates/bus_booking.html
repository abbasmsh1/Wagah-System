{% extends "base.html" %}

{% block content %}
<h1>Bus Booking</h1>
<form id="searchForm" method="get" action="/bus-booking/">
    <label for="its">Search by ITS:</label>
    <input type="number" id="its" name="its" required>
    <button type="submit">Search</button>
</form>

{% if person %}
    <h2>Person Details</h2>
    <p>ITS: {{ person.ITS }}</p>
    <p>Name: {{ person.first_name }}</p>
    <p>Phone: {{ person.phone }}</p>

    <h2>Group Information</h2>
    <table>
        <thead>
            <tr>
                <th>ITS</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody id="groupMembersTableBody">
            <!-- This section will be populated by the script below -->
        </tbody>
    </table>

    <h2>Book a Bus</h2>
    <form id="bookingForm" action="/book-bus/" method="post">
        <input type="hidden" name="its" value="{{ person.ITS }}">
        <label for="type">Type:</label>
        <select id="type" name="type" required>
            <option value="business">Business</option>
            <option value="executive">Executive</option>
        </select><br>
        <label for="bus_number">Bus Number:</label>
        <select id="bus_number" name="bus_number" required>
            <option value="">Select Bus Number</option>
            {% for bus in buses %}
                <option value="{{ bus.bus_number }}">{{ bus.bus_number }}</option>
            {% endfor %}
        </select><br>
        <label for="no_of_seats">Number of Seats:</label>
        <input type="number" id="no_of_seats" name="no_of_seats" required><br>
        <label for="seats_left">Seats Left:</label>
        <span id="seats_left"></span><br>
        <button type="submit">Book Bus</button>
    </form>
{% elif search %}
    <p>No person found with ITS number {{ search }}</p>
{% endif %}

{% if message %}
    <p>{{ message }}</p>
{% endif %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Add your JavaScript to fetch and display group members
        const displayGroupMembers = (itsList) => {
            const tableBody = document.getElementById("groupMembersTableBody");
            tableBody.innerHTML = "";
            itsList.forEach(member => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${member.ITS}</td>
                    <td>${member.first_name}</td>
                `;
                tableBody.appendChild(row);
            });
        };

        // Example of fetching group members (you'll need to implement the corresponding endpoint)
        fetch(`/get-group-members/?its={{ person.ITS }}`)
            .then(response => response.json())
            .then(data => displayGroupMembers(data.group_members))
            .catch(error => console.error('Error fetching group members:', error));
    });
</script>
{% endblock %}
