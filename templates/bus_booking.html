{% extends "base.html" %}

{% block content %}
<h2>Bus Booking</h2>
<form action="/bus-booking/" method="post">
    <label for="bus_number">Select Bus:</label>
    <select id="bus_number" name="bus_number">
        {% for bus in buses %}
            <option value="{{ bus.bus_number }}">{{ bus.bus_number }} ({{ bus.no_of_seats }} seats)</option>
        {% endfor %}
    </select>
    <br>
    <label for="its">ITS:</label>
    <input type="number" id="its" name="its" required>
    <br>
    <label for="seats">Select Seats:</label>
    <br>
    <table>
        <tr>
            {% for i in range(1, buses[0].no_of_seats + 1) %}
                <td>
                    {% if i in booked_seats %}
                        <span style="color: red;">Booked</span>
                    {% else %}
                        <input type="checkbox" id="seat_{{ i }}" value="{{ i }}">
                    {% endif %}
                </td>
                {% if loop.index % 10 == 0 %}
                    </tr><tr>
                {% endif %}
            {% endfor %}
        </tr>
    </table>
    <input type="hidden" id="seats" name="seats">
    <br>
    <input type="submit" value="Book Seats" onclick="getSelectedSeats()">
    <script>
        function getSelectedSeats() {
            var seats = [];
            for (var i = 1; i <= {{ buses[0].no_of_seats }}; i++) {
                if (document.getElementById("seat_" + i).checked) {
                    seats.push(i);
                }
            }
            document.getElementById("seats").value = seats.join(",");
        }
    </script>
</form>
{% endblock %}
